version: '3.8'

services:
  pbs:
    image: ${IMAGE:-ayufan/proxmox-backup-server:${TAG:-latest}}
    container_name: pbs-test
    ports:
      - "8007:8007"
    environment:
      - PBS_ROOT_PASSWORD=pbspbs
    mem_limit: 2G
    tmpfs:
      - /run
    cap_add:
      - SYS_RAWIO # smartctl support
    restart: unless-stopped
    stop_signal: SIGHUP
    healthcheck:
      test: ["CMD-SHELL", "curl -k -f https://localhost:8007 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 30
      start_period: 60s

networks:
  default:
    name: pbs-test-network